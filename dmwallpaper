#!/usr/bin/env bash
# Specifying a directory with wallpapers and make sure it exists
wall_dir="$HOME/Pictures/wallpapers"
mkdir -p "${wall_dir}"

# get the number of connected screens
screens=$(xrandr | grep -e "\sconnected" | wc -l)

autostart_script="$HOME/.config/autostart-scripts/autostart.sh"
autostart_script_org="$HOME/.config/README.org"

updateAutostart(){
    sed -i "s/\(.*dmwallpaper\).*$/\1 $1 \&/" $autostart_script
    sed -i "s/\(.*dmwallpaper\).*$/\1 $1 \&/" $autostart_script_org
}

dmenu_prompt="Wallpaper Category"

setRandomWallpaper(){
    if [ -z "$1" ]; then
        return
    fi

    for (( i = 0; i < $screens; i++ )); do
        nitrogen --set-zoom-fill --random --head=$i $wall_dir/$1/
    done

    # Comment out this line if you don't use an autostart script to set random wallpapers using this dmscript
    updateAutostart "$1"
}

if [ ! $# -eq 0 ]; then setRandomWallpaper $1

else
    choice=$(\ls $wall_dir --hide="*.*" | rofi -dmenu -i -p "${dmenu_prompt}")
    setRandomWallpaper $choice
fi
